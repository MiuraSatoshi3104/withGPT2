<!DOCTYPE html>
<html>

<head>
    <title>あなたのウェブサイトのタイトル</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css" href="tetris.css">　

    <title>My Page</title>
    <title>Tetris</title>
    <title>Tetris Game</title>
    <script src="js/tetris.js"></script>
    <style>
        /* ゲームボードのスタイル */
        #game-board {
            width: 300px;
            height: 600px;
            background-color: #eee;
            margin: 0 auto;
            position: relative;
        }

        /* ブロックのスタイル */
        .block {
            position: absolute;
            width: 29px;
            height: 29px;
            border: 1px solid #ccc;
        }

        /* ブロックの種類ごとの色 */
        .block.type1 {
            background-color: #f00;
        }

        .block.type2 {
            background-color: #0f0;
        }

        .block.type3 {
            background-color: #00f;
        }

        .block.type4 {
            background-color: #ff0;
        }

        .block.type5 {
            background-color: #f0f;
        }

        .block.type6 {
            background-color: #0ff;
        }

        .block.type7 {
            background-color: #ccc;
        }

        /* 操作ボタンのスタイル */
        button {
            display: block;
            margin: 20px auto;
            font-size: 18px;
            padding: 10px 20px;
        }
    </style>
</head>

<body>
    <div id="game-board"></div>
    <button id="start-button">Start Game</button>
    <button id="pause-button">Pause Game</button>
    <script>
        // ゲームボードの大きさ
        const ROWS = 20;
        const COLS = 10;
        // ブロックのサイズ
        const BLOCK_SIZE = 30;
        // ブロックの初期位置
        const START_ROW = 0;
        const START_COL = 3;
        // ブロックの種類と形
        const BLOCK_TYPES = [
            {
                type: 'type1',
                shape: [[1, 1, 1], [0, 1, 0]]
            },
            {
                type: 'type2',
                shape: [[0, 1, 1], [1, 1, 0]]
            },
            {
                type: 'type3',
                shape: [[1, 1, 0], [0, 1, 1]]
            },
            {
                type: 'type4',
                shape: [[1, 0, 0], [1, 1, 1]]
            },
            {
                type: 'type5',
                shape: [[0, 0, 1], [1, 1, 1]]
            },
            {
                type: 'type6',
                shape: [[1, 1], [1, 1]]
            },
            {
                type: 'type7',
                shape: [[1, 1, 1, 1]]
            }
        ];
        // ゲームの状態
        let board, currentBlock, timerId, isPlaying;
        // DOM要素の取得
        const gameBoard = document.getElementById('game-board');
        const startButton = document.getElementById('start-button');
        const pauseButton = document.getElementById('pause-button');
        // ゲームを初期化する
        function init() {
            board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
            currentBlock = getRandomBlock();
            isPlaying = true;
            draw();
            startTimer();
        }

        // ゲームを描画する
        function draw() {
            // ゲームボードをクリアする
            gameBoard.innerHTML = '';
            // グリッドを描画する
            for (var i = 0; i < board.length; i++) {
                for (var j = 0; j < board[0].length; j++) {
                    if (board[i][j]) {
                        drawBlock(j, i, board[i][j]);
                    }
                }
            }

            // 現在のブロックを描画する
            drawCurrentBlock();
        }
    </script>

    <head>
        <style>
            body {
                background-color: black;
                background-image: url("");
                background-repeat: no- repeat;
                background-size: cover;
            }

            .container {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }

            input[type="text"] {
                font-size: 24px;
                padding: 8px;
                margin: 8px;
                border-radius: 8px;
                border: none;
                outline: none;
                background-color: white;
                color: black;
                width: 60%;
                max-width: 600px;
            }

            button {
                font-size: 24px;
                padding: 8px;
                margin: 8px;
                border-radius: 8px;
                border: none;
                outline: none;
                background-color: green;
                color: white;
            }

            #send -button:hover {
                background-color: blue;
                color: white;
                box-shadow: 2px 2px 4px gray;
            }

            #send -button:active {
                box-shadow: none;
                transform: translateY(2px);
            }

            #canvas {
                border: 2px solid black;
            }
        </style>
    </head>

    <body>
        <div id="tetris">
            <div id="game-board"></div>
            <div id="next-piece"></div>
            <div id="score"></div>
        </div>
        <script src="tetris.js"></script>

        <header>
            <h1>あなたのウェブサイトのタイトル</h1>
        </header>
        <canvas id="canvas" width="240" height="400"></canvas>
        <nav>
            <ul>
                <li><a href="#">ホーム</a></li>
                <li><a href="#">プロフィール</a></li>
                <li><a href="#">コンタクト</a></li>
            </ul>
        </nav>
        <main>
            <section>
                <h2>セクションのタイトル</h2>
                <p>ここにセクションのコンテンツを記述します。</p>
                <button id="generate-button">生成する</button>
                <div id="result"></div>
            </section>
        </main>
        <footer>
            <p>Copyright © 2023 あなたのウェブサイトの名前</p>
        </footer>
        <script src="script.js"></script>

        <div class="container">
            <input type="text" id="text-input" placeholder="Enter your text here">
            <button id="send-button">Send</button>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function () {
                $('#send-button').click(function () {
                    var text = $('#text-input').val();
                    var url = 'https://api.midjourney.com/image?text=' + text;
                    $.get(url, function (data) {
                        $('body').css('background-image', 'url(' + data + ')');
                    });
                });
            });
        </script>

        <script>
            // ゲームの状態を保持する変数
            var gameState = {
                score: 0,
                level: 1,
                gameOver: false,
                paused: false,
                grid: [],
                currentPiece: null,
                nextPiece: null,
            };

            // テトリスのブロック種類
            var blockTypes = [
                {
                    color: "cyan",
                    shape: [
                        [0, 0, 0, 0],
                        [1, 1, 1, 1],
                        [0, 0, 0, 0],
                        [0, 0, 0, 0],
                    ],
                },
                {
                    color: "yellow",
                    shape: [
                        [0, 0, 0, 0],
                        [0, 1, 1, 0],
                        [0, 1, 1, 0],
                        [0, 0, 0, 0],
                    ],
                },
                {
                    color: "purple",
                    shape: [
                        [0, 0, 0, 0],
                        [0, 1, 1, 0],
                        [1, 1, 0, 0],
                        [0, 0, 0, 0],
                    ],
                },
                {
                    color: "green",
                    shape: [
                        [0, 0, 0, 0],
                        [0, 1, 1, 0],
                        [0, 0, 1, 1],
                        [0, 0, 0, 0],
                    ],
                },
                {
                    color: "red",
                    shape: [
                        [0, 0, 0, 0],
                        [0, 1, 1, 0],
                        [0, 1, 0, 0],
                        [0, 1, 0, 0],
                    ],
                },
                {
                    color: "blue",
                    shape: [
                        [0, 0, 0, 0],
                        [1, 1, 0, 0],
                        [0, 1, 1, 0],
                        [0, 0, 0, 0],
                    ],
                },
                {
                    color: "orange",
                    shape: [
                        [0, 0, 0, 0],
                        [0, 1, 1, 0],
                        [1, 1, 0, 0],
                        [0, 0, 0, 0],
                    ],
                },
            ];

            // テトリスのブロッククラス
            class Block {
                constructor(type) {
                    this.type = type;
                    this.color = type.color;
                    this.shape = type.shape;
                    this.x = Math.floor((10 - this.shape[0].length) / 2);
                    this.y = -this
                    this.rotation = 0;
                }

                // ブロックを回転させる
                rotate() {
                    var rotated = [];
                    for (var i = 0; i < this.shape[0].length; i++) {
                        rotated.push([]);
                        for (var j = this.shape.length - 1; j >= 0; j--) {
                            rotated[i].push(this.shape[j][i]);
                        }
                    }
                    this.shape = rotated;
                    this.rotation = (this.rotation + 1) % 4;
                }

                // ブロックを移動する
                move(dx, dy) {
                    this.x += dx;
                    this.y += dy;
                }

                // ブロックを下に移動する
                moveDown() {
                    this.move(0, 1);
                }

                // ブロックを左に移動する
                moveLeft() {
                    this.move(-1, 0);
                }

                // ブロックを右に移動する
                moveRight() {
                    this.move(1, 0);
                }
            }

            // ゲームの初期化
            function initGame() {
                // ゲーム状態を初期化
                gameState.score = 0;
                gameState.level = 1;
                gameState.gameOver = false;
                gameState.paused = false;
                gameState.grid = [];
                for (var i = 0; i < 20; i++) {
                    gameState.grid.push(new Array(10).fill(null));
                }

                // 最初のブロックを生成
                gameState.currentPiece = getRandomBlock();
                gameState.nextPiece = getRandomBlock();

                // ゲームループを開始
                setInterval(gameLoop, 500);
            }

            // ゲームループ
            function gameLoop() {
                if (!gameState.paused) {
                    // ブロックを1マス下に移動
                    gameState.currentPiece.moveDown();

                    // 衝突判定
                    if (isCollision(gameState.currentPiece)) {
                        // ブロックを戻す
                        gameState.currentPiece.move(0, -1);

                        // ブロックを固定する
                        for (var i = 0; i < gameState.currentPiece.shape.length; i++) {
                            for (var j = 0; j < gameState.currentPiece.shape[0].length; j++) {
                                if (gameState.currentPiece.shape[i][j] !== 0) {
                                    gameState.grid[gameState.currentPiece.y + i][gameState.currentPiece.x + j] =
                                        gameState.currentPiece.color;
                                }
                            }
                        }

                        // 消去判定
                        var linesCleared = clearLines();
                        if (linesCleared > 0) {
                            // スコアを加算
                            gameState.score += 100 * linesCleared;

                            // レベルアップ判定
                            if (gameState.score >= gameState.level * 1000) {
                                gameState.level++;
                            }
                        }

                        // 次のブロックを生成
                        gameState.currentPiece = gameState.nextPiece;
                        gameState.nextPiece = getRandomBlock();

                        // ゲームオーバー判定
                        if (isCollision(gameState.currentPiece)) {
                            gameState.gameOver = true;
                            alert("Game over!");
                        }
                    }
                }

                // ゲーム画面を描画
                drawGame();
            }

            // ランダムなブロック
            function getRandomBlock() {
                var blocks = [[[1, 1],
                [1, 1],
                ], // 四角形ブロック
                [[1, 0, 0],
                [1, 1, 1],
                ], // L字型ブロック
                [[0, 0, 1],
                [1, 1, 1],
                ], // J字型ブロック
                [[0, 1, 1],
                [1, 1, 0],
                ], // S字型ブロック
                [[1, 1, 0],
                [0, 1, 1],
                ], // Z字型ブロック
                [[1, 1, 1],
                [0, 1, 0],
                ], // T字型ブロック
                [[0, 1, 0, 0],
                [0, 1, 0, 0],
                [0, 1, 0, 0],
                [0, 1, 0, 0],
                ], // I字型ブロック
                ];
                var colors = ["red", "orange", "yellow", "green", "blue", "purple", "pink"];
                var index = Math.floor(Math.random() * blocks.length);
                var block = new Block(blocks[index], colors[index]);
                return block;
            }

            // 衝突判定
            function isCollision(piece) {
                for (var i = 0; i < piece.shape.length; i++) {
                    for (var j = 0; j < piece.shape[0].length; j++) {
                        if (
                            piece.shape[i][j] !== 0 &&
                            (piece.y + i >= 20 ||
                                piece.x + j < 0 ||
                                piece.x + j >= 10 ||
                                gameState.grid[piece.y + i][piece.x + j] !== null)
                        ) {
                            return true;
                        }
                    }
                }
                return false;
            }

            // 行を消去する
            function clearLine(row) {
                // 行を削除
                gameState.grid.splice(row, 1);

                // 新しい行を追加
                gameState.grid.unshift(new Array(10).fill(null));
            }

            // ブロックを描画する
            function drawBlock(ctx, piece, x, y) {
                for (var i = 0; i < piece.shape.length; i++) {
                    for (var j = 0; j < piece.shape[0].length; j++) {
                        if (piece.shape[i][j] !== 0) {
                            ctx.fillStyle = piece.color;
                            ctx.fillRect(x + j, y + i, 1, 1);
                            ctx.strokeStyle = "white";
                            ctx.strokeRect(x + j, y + i, 1, 1);
                        }
                    }
                }
            }

            // ゲーム画面を描画する
            function drawGame() {
                // キャンバスをクリア
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // 背景を描画
                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // ゲームオーバーの場合はメッセージを描画
                if (gameState.gameOver) {
                    ctx.fillStyle = "white";
                    ctx.font = "30px Arial";
                    ctx.fillStyle = "red";
                    ctx.textAlign = "center";
                    ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2);
                    return;
                }

                // ブロックを描画
                drawBlock(ctx, gameState.currentBlock, gameState.currentX, gameState.currentY);

                // ゲーム盤を描画
                for (var i = 0; i < gameState.grid.length; i++) {
                    for (var j = 0; j < gameState.grid[0].length; j++) {
                        if (gameState.grid[i][j] !== null) {
                            ctx.fillStyle = gameState.grid[i][j];
                            ctx.fillRect(j, i, 1, 1);
                            ctx.strokeStyle = "white";
                            ctx.strokeRect(j, i, 1, 1);
                        }
                    }
                }

                // スコアを描画
                ctx.font = "20px Arial";
                ctx.fillStyle = "white";
                ctx.textAlign = "left";
                ctx.fillText("Score: " + gameState.score, 10, 20);
            }

            // ブロックを固定する
            function fixBlock() {
                for (var i = 0; i < gameState.currentBlock.shape.length; i++) {
                    for (var j = 0; j < gameState.currentBlock.shape[0].length; j++) {
                        if (gameState.currentBlock.shape[i][j] !== 0) {
                            gameState.grid[gameState.currentY + i][gameState.currentX + j] =
                                gameState.currentBlock.color;
                        }
                    }
                }

                // 行が揃っているか調べる
                var rowCount = 0;
                for (var i = 0; i < gameState.grid.length; i++) {
                    if (gameState.grid[i].every((cell) => cell !== null)) {
                        clearLine(i);
                        rowCount++;
                    }
                }

                // スコアを更新する
                if (rowCount > 0) {
                    gameState.score += rowCount * 100;
                }

                // 新しいブロックを生成する
                gameState.currentBlock = getRandomBlock();
                gameState.currentX = Math.floor(10 / 2) - Math.floor(gameState.currentBlock.shape[0] / 2);
                gameState.currentY = 0;

                // 衝突している場合はゲームオーバー
                if (isCollision(gameState.currentBlock)) {
                    gameState.gameOver = true;
                }
            }

            // ゲームループ
            function gameLoop() {
                // ブロックを下に移動する
                gameState.currentY++;

                // 衝突している場合はブロックを固定する
                if (isCollision(gameState.currentBlock)) {
                    gameState.currentY--;
                    fixBlock();
                }

                // ゲームを描画する
                drawGame();

                // 次のフレームを実行する
                requestAnimationFrame(gameLoop);
            }

            // ゲームを初期化する
            function init() {
                // ゲーム盤を初期化する
                gameState.grid = new Array(20);
                for (var i = 0; i < gameState.grid.length; i++) {
                    gameState.grid[i] = new Array(10).fill(null);
                }


                // ゲームを開始する
                gameState.currentBlock = getRandomBlock();
                gameState.currentBlock.column = Math.floor(gameState.grid[0].length / 2);
                gameState.currentBlock.row = 0;
                if (checkCollision(gameState.currentBlock)) {
                    gameOver();
                    return;
                }

                // ゲームループを開始する
                gameState.intervalId = setInterval(function () {
                    update();
                    draw();
                }, gameState.speed);


                gameState.currentBlock = getRandomBlock();

                // ブロックを描画する位置を計算する
                var x = Math.floor(gameState.grid[0].length / 2) - Math.floor(gameState.currentBlock.shape[0] / 2);
                var y = 0;

                // ゲーム状態を初期化する
                gameState.currentX = x;
                gameState.currentY = y;
                gameState.score = 0;
                gameState.gameOver = false;


                // キーボードイベントを設定する
                document.addEventListener("keydown", handleKeyDown);

                // ゲームループを開始する
                gameLoop();
            }

            // キーボードイベントを処理する
            function handleKeyDown(event) {
                switch (event.keyCode) {
                    case 37: // 左
                        gameState.currentX--;
                        if (isCollision(gameState.currentBlock)) {
                            gameState.currentX++;
                        }
                        break;
                    case 38: // 上
                        gameState.currentBlock = rotateBlock(gameState.currentBlock);
                        if (isCollision(gameState.currentBlock)) {
                            gameState.currentBlock = rotateBlock(gameState.currentBlock, -1);
                        }
                        break;
                    case 39: // 右
                        gameState.currentX++;
                        if (isCollision(gameState.currentBlock)) {
                            gameState.currentX--;
                        }
                        break;
                    case 40: // 下
                        gameState.currentY++;
                        if (isCollision(gameState.currentBlock)) {
                            gameState.currentY--;
                            fixBlock();
                        }
                        break;
                }
            }

            // ブロックを回転する
            function rotateBlock(block, direction = 1) {
                var newBlock = [];
                for (var i = 0; i < block.shape[0].length; i++) {
                    newBlock.push(new Array(block.shape.length).fill(0));
                }
                for (var i = 0; i < block.shape.length; i++) {
                    for (var j = 0; j < block.shape[0].length; j++) {
                        if (direction === 1) {
                            newBlock[j][block.shape.length - i - 1] = block.shape[i][j];
                        } else {
                            newBlock[block.shape.length - j - 1][i] = block.shape[i][j];
                        }
                    }
                }
                return { shape: newBlock, color: block.color };
            }

            // ブロックが衝突しているか調べる
            function isCollision(block) {
                for (var i = 0; i < block.shape.length; i++) {
                    for (var j = 0; j < block.shape[0].length; j++) {
                        if (
                            block.shape[i][j] !== 0 &&
                            (gameState.currentY + i >= gameState.grid.length ||
                                gameState.currentX + j < 0 ||
                                gameState.currentX + j >= gameState.grid[0].length ||
                                gameState.grid[gameState.currentY + i][gameState.currentX + j] !== null)
                        ) {
                            return true;
                        }
                    }
                }
                return false;
            }

            // ランダムなブロックを生成する
            function getRandomBlock() {
                var blocks = [{ shape: [[1, 1], [1, 1]], color: "cyan" },
                { shape: [[0, 2, 0], [2, 2, 2]], color: "blue" },
                { shape: [[3, 3, 0], [0, 3, 3]], color: "orange" },
                { shape: [[4, 4, 4], [0, 4, 0]], color: "yellow" },
                { shape: [[5, 0, 0], [5, 5, 5]], color: "green" },
                { shape: [[0, 0, 6], [6, 6, 6]], color: "purple" },
                { shape: [[7, 7, 7, 7]], color: "red" },
                ];
                var block = blocks[Math.floor(Math.random() * blocks.length)];
                return block;
            }

            // ブロックを固定する
            function fixBlock() {
                for (var i = 0; i < gameState.currentBlock.shape.length; i++) {
                    for (var j = 0; j < gameState.currentBlock.shape[0].length; j++) {
                        if (gameState.currentBlock.shape[i][j] !== 0) {
                            gameState.grid[gameState.currentY + i][gameState.currentX + j] = gameState.currentBlock.color;
                        }
                    }
                }
                removeLines();
                gameState.currentBlock = getRandomBlock();
                var X = Math.floor(10 / 2) - Math.floor(gameState.currentBlock.shape[0] / 2);
                gameState.currentX = X;
                gameState.currentY = 0;
                if (isCollision(gameState.currentBlock)) {
                    gameState.gameOver = true;
                }
            }

            // 揃ったラインを消す
            function removeLines() {
                var lines = 0;
                for (var i = gameState.grid.length - 1; i >= 0; i--) {
                    var rowFilled = true;
                    for (var j = 0; j < gameState.grid[i].length; j++) {
                        if (gameState.grid[i][j] === null) {
                            rowFilled = false;
                            break;
                        }
                    }
                    if (rowFilled) {
                        lines++;
                        for (var y = i; y > 0; y--) {
                            for (var x = 0; x < gameState.grid[y].length; x++) {
                                gameState.grid[y][x] = gameState.grid[y - 1][x];
                            }
                        }
                        for (var x = 0; x < gameState.grid[0].length; x++) {
                            gameState.grid[0][x] = null;
                        }
                        i++;
                    }
                }
                switch (lines) {
                    case 1:
                        gameState.score += 40;
                        break;
                    case 2:
                        gameState.score += 100;
                        break;
                    case 3:
                        gameState.score += 300;
                        break;
                    case 4:
                        gameState.score += 1200;
                        break;
                }
            }

            // ゲームループを実行する
            function gameLoop() {
                // ゲームオーバーの場合は終了する
                if (gameState.gameOver) {
                    alert("ゲームオーバー\nスコア: " + gameState.score);
                    return;
                }
            }
            // ブロックを落とす
            gameState.currentY++;
            if (isCollision(gameState.currentBlock)) {
                gameState.currentY--;
                fixBlock();
            }

            // 背景を描画する
            context.fillStyle = "#000000";
            context.fillRect(0, 0, canvas.width, canvas.height);

            // グリッドを描画する
            for (var i = 0; i < gameState.grid.length; i++) {
                for (var j = 0; j < gameState.grid[0].length; j++) {
                    if (gameState.grid[i][j] !== 0) {
                        ctx.fillStyle = colors[gameState.grid[i][j] - 1];
                        ctx.fillRect(j * blockSize, i * blockSize, blockSize, blockSize);

                        ctx.strokeStyle = "rgba(0, 0, 0, 0.1)";
                        ctx.strokeRect(j * blockSize, i * blockSize, blockSize, blockSize);
                    }
                }
            }
        </script>
    </body>
</body>

</html>
